# 이메일 발송 기능 가이드

Newsletter Generator는 생성된 뉴스레터를 이메일로 즉시 발송할 수 있는 기능을 제공합니다.

## 기능 개요

- **즉시 발송**: 뉴스레터 생성 완료 후 자동으로 이메일 발송
- **선택적 기능**: 이메일 주소를 입력하지 않으면 생성만 수행
- **실시간 상태**: 발송 진행 상황을 실시간으로 확인
- **발송 확인**: 성공/실패 상태를 명확히 표시

## 사용 방법

### 1. 기본 사용법

1. **뉴스레터 생성 페이지**에서 키워드 또는 도메인을 입력
2. **이메일 주소** 필드에 받을 이메일 주소 입력 (선택사항)
3. **생성하기** 버튼 클릭
4. 생성 완료 후 자동으로 이메일 발송

### 2. 이메일 주소 입력

```
이메일 주소 [선택]
┌─────────────────────────────────────────┐
│ newsletter@example.com                  │
└─────────────────────────────────────────┘
이메일 주소를 입력하면 생성 완료 후 즉시 발송됩니다.
```

- **형식**: 유효한 이메일 주소 형식 (예: user@domain.com)
- **선택사항**: 입력하지 않으면 생성만 수행
- **즉시 발송**: 입력하면 생성 완료 후 자동 발송

### 3. 진행 상황 확인

생성 중에는 다음과 같은 상태를 확인할 수 있습니다:

- **생성 중**: "뉴스레터를 생성하고 있습니다..."
- **발송 완료**: "뉴스레터 생성 완료 및 이메일 발송 완료..."
- **성공 알림**: 화면 우상단에 발송 완료 알림 표시

## 이메일 설정

### 필수 환경 변수

이메일 발송을 위해서는 다음 환경 변수가 설정되어야 합니다:

```bash
# Postmark 서버 토큰
POSTMARK_SERVER_TOKEN=your_postmark_server_token

# 발신자 이메일 주소
EMAIL_SENDER=noreply@yourdomain.com
```

### 설정 확인

1. **이메일 설정 확인** 버튼을 클릭하여 현재 설정 상태 확인
2. 설정이 완료되지 않은 경우 안내 메시지 표시
3. **테스트 이메일 발송** 기능으로 설정 검증

## 발송 결과

### 성공 시

- ✅ 화면 우상단에 성공 알림 표시
- 발송된 이메일 주소 확인 가능
- 히스토리에 발송 상태 기록

### 실패 시

- ❌ 오류 메시지 표시
- 실패 원인 안내 (설정 오류, 네트워크 오류 등)
- 재시도 가능

## 주의사항

### 이메일 제한

- **Postmark 계정**: 유효한 Postmark 계정 필요
- **발신자 인증**: 발신자 이메일 주소는 Postmark에서 인증된 도메인이어야 함
- **일일 한도**: Postmark 계정의 일일 발송 한도 확인 필요

### 보안

- **환경 변수**: 토큰은 환경 변수로만 설정, 코드에 하드코딩 금지
- **HTTPS**: 프로덕션 환경에서는 반드시 HTTPS 사용
- **접근 제한**: 필요시 IP 제한 또는 인증 추가

## 문제 해결

### 일반적인 오류

1. **"POSTMARK_SERVER_TOKEN 환경변수가 설정되지 않았습니다"**
   - 환경 변수 설정 확인
   - 서버 재시작 필요할 수 있음

2. **"EMAIL_SENDER 환경변수가 설정되지 않았습니다"**
   - 발신자 이메일 주소 설정 확인
   - Postmark에서 도메인 인증 확인

3. **"Postmark 이메일 발송 실패"**
   - 네트워크 연결 확인
   - Postmark 계정 상태 확인
   - 일일 발송 한도 확인

### 디버깅

1. **이메일 설정 확인** 버튼으로 현재 상태 점검
2. **테스트 이메일 발송**으로 기본 기능 검증
3. 브라우저 개발자 도구에서 네트워크 탭 확인
4. 서버 로그에서 상세 오류 메시지 확인

## API 사용법

프로그래밍 방식으로 이메일 발송을 원하는 경우:

```bash
# 이메일과 함께 뉴스레터 생성
curl -X POST http://localhost:5000/api/generate \
  -H "Content-Type: application/json" \
  -d '{
    "keywords": "AI, machine learning",
    "email": "recipient@example.com",
    "template_style": "compact",
    "period": 14
  }'

# 응답
{
  "job_id": "uuid-here",
  "status": "queued"
}

# 상태 확인 (sent 필드 포함)
curl http://localhost:5000/api/status/uuid-here

# 응답
{
  "job_id": "uuid-here",
  "status": "completed",
  "sent": true,
  "result": {
    "email_sent": true,
    "email_to": "recipient@example.com"
  }
}
```

## 관련 문서

- [설치 가이드](../setup/installation.md)
- [환경 설정](../setup/configuration.md)
- [API 문서](../technical/api.md)
- [문제 해결](../setup/troubleshooting.md) 
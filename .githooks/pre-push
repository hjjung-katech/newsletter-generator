#!/bin/sh
# Git pre-push hook
# CI 검사를 통과하지 못하는 코드의 푸시를 방지합니다.
#
# 설치 방법:
#   1. .githooks 디렉토리를 Git hooks 디렉토리로 설정:
#      git config core.hooksPath .githooks
#   2. 또는 이 파일을 .git/hooks/pre-push로 복사
#   3. 실행 권한 부여 (Unix/Mac):
#      chmod +x .githooks/pre-push

echo "🔍 Pre-push CI 검증 시작..."

# Python 실행 파일 찾기
if command -v python3 >/dev/null 2>&1; then
    PYTHON=python3
elif command -v python >/dev/null 2>&1; then
    PYTHON=python
else
    echo "❌ Python이 설치되지 않았습니다."
    exit 1
fi

# CI 검사 스크립트 실행
echo "📋 코드 품질 검사 중..."
$PYTHON run_ci_checks.py --quick

if [ $? -ne 0 ]; then
    echo ""
    echo "❌ CI 검사 실패!"
    echo "   코드를 수정한 후 다시 시도하세요."
    echo ""
    echo "💡 자동 수정 시도:"
    echo "   python run_ci_checks.py --fix"
    echo ""
    echo "⚠️  강제 푸시 (권장하지 않음):"
    echo "   git push --no-verify"
    exit 1
fi

echo "✅ 모든 검사 통과! 푸시를 진행합니다..."
exit 0
